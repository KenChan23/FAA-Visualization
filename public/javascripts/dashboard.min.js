!function(){function a(a){var b=new Date(a.getFullYear(),a.getMonth()+1,0),c=+i(a),d=+j(a),e=+i(b),f=+j(b);return"M"+(d+1)*h+","+c*h+"H"+d*h+"V"+7*h+"H"+f*h+"V"+(e+1)*h+"H"+(f+1)*h+"V0H"+(d+1)*h+"Z"}var b,c,d=13,e=13,f=750,g=100,h=13,i=d3.time.format("%w"),j=d3.time.format("%U"),k=d3.time.format("%Y-%m-%d"),l=d3.scale.quantize().domain([0,d]).range(d3.range(d).map(function(a){return"q-fatality"+a+"-13"})),m=d3.scale.quantize().domain([0,e]).range(d3.range(e).map(function(a){return"q-fatality"+a+"-13"})),n=d3.select("body").selectAll("svg").data(d3.range(1980,1985)).enter().append("svg").attr("width",f).attr("height",g).attr("class","RdYlGn").append("g").attr("transform","translate("+(f-53*h)/2+","+(g-7*h-1)+")");n.append("text").attr("transform","translate(-6,"+3.5*h+")rotate(-90)").style("text-anchor","middle").text(function(a){return a});var o=n.selectAll(".day").data(function(a){return d3.time.days(new Date(a,0,1),new Date(a+1,0,1))}).enter().append("rect").attr("class","day").attr("width",h).attr("height",h).attr("x",function(a){return j(a)*h}).attr("y",function(a){return i(a)*h}).datum(k);o.append("title").text(function(a){return a}),n.selectAll(".month").data(function(a){return d3.time.months(new Date(a,0,1),new Date(a+1,0,1))}).enter().append("path").attr("class","month").attr("d",a),d3.csv("../data/part_91_csv/data_1980_84.csv",function(a,d){c=d3.nest().key(function(a){return a.date}).rollup(function(a){return d3.sum(a,function(a){return null!==a.fatalities?parseInt(a.fatalities):0})}).map(d),b=d3.nest().key(function(a){return a.date}).rollup(function(a){return a.length}).map(d),o.filter(function(a){return a in c}).attr("class",function(a){return"day "+l(c[a])}).select("title").text(function(a){return 0==c[a]?a+": No fatalities!":1==c[a]?a+": "+c[a]+" fatality":a+": "+c[a]+" fatalities"})}),d3.select(self.frameElement).style("height","2910px");var p=function(){function a(a,d){var e;switch(a){case"#fatalities":console.log("inside case fatalities"),e=c,color=l;break;case"#accidents":console.log("inside case accidents"),e=b,color=m}d(e,color)}function d(a,b,c){console.log("inside default"),o.filter(function(b){return b in a}).attr("class",function(c){return"day "+b(a[c])}).select("title").text(function(b){switch(c){case"#fatalities":return 0==a[b]?b+": No fatalities!":1==a[b]?b+": "+a[b]+" fatality":b+": "+a[b]+" fatalities";case"#accidents":return 0==a[b]?b+": No accidents!":1==a[b]?b+": "+a[b]+" accident":b+": "+a[b]+" accidents"}})}d3.selectAll("#accidents, #fatalities").on("click",function(){$("#accidents").is(":checked")&&a("#accidents",function(a,b){d(a,b,"#accidents")}),$("#fatalities").is(":checked")&&a("#fatalities",function(a,b){d(a,b,"#fatalities")})})};p(),d3.select("#side-button").on("click",function(){})}(),function(){var a=150,b=19.5,c=d3.scale.linear().range([b/2,a-b/2]),d=d3.scale.linear().range([a-b/2,b/2]),e=d3.svg.axis().scale(c).orient("bottom").ticks(5),f=d3.svg.axis().scale(d).orient("left").ticks(5),g=d3.scale.category10();d3.csv("../javascripts/flowers.csv",function(h,i){function j(e){var f=d3.select(this);c.domain(l[e.x]),d.domain(l[e.y]),f.append("rect").attr("class","frame").attr("x",b/2).attr("y",b/2).attr("width",a-b).attr("height",a-b),f.selectAll("circle").data(i).enter().append("circle").attr("cx",function(a){return c(a[e.x])}).attr("cy",function(a){return d(a[e.y])}).attr("r",3).style("fill",function(a){return g(a.species)})}function k(a,b){var c,d,e=[],f=a.length,g=b.length;for(c=-1;++c<f;)for(d=-1;++d<g;)e.push({x:a[c],i:c,y:b[d],j:d});return e}var l={},m=d3.keys(i[0]).filter(function(a){return"species"!==a}),n=m.length;m.forEach(function(a){l[a]=d3.extent(i,function(b){return b[a]})}),e.tickSize(a*n),f.tickSize(-a*n);var o=d3.select("body").append("svg").attr("width",a*n+b).attr("height",a*n+b).append("g").attr("transform","translate("+b+","+b/2+")");o.selectAll(".x.axis").data(m).enter().append("g").attr("class","x axis").attr("transform",function(b,c){return"translate("+(n-c-1)*a+",0)"}).each(function(a){c.domain(l[a]),d3.select(this).call(e)}),o.selectAll(".y.axis").data(m).enter().append("g").attr("class","y axis").attr("transform",function(b,c){return"translate(0,"+c*a+")"}).each(function(a){d.domain(l[a]),d3.select(this).call(f)});var p=o.selectAll(".cell").data(k(m,m)).enter().append("g").attr("class","cell").attr("transform",function(b){return"translate("+(n-b.i-1)*a+","+b.j*a+")"}).each(j);p.filter(function(a){return a.i===a.j}).append("text").attr("x",b).attr("y",b).attr("dy",".71em").text(function(a){return a.x}),d3.select(self.frameElement).style("height",a*n+b+20+"px")})}();