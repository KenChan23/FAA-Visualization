!function(){function a(a){s="<p>"+a.category+"</p>",hoveredBar=d3.select(this),d3.selectAll(".g rect").filter(function(b){return b!==a}).style("opacity",.3),d3.select("#hello").html(s)}function b(){d3.selectAll(".g rect").style("opacity",1)}function c(c){function d(c){barChartData.forEach(function(a){a.categories=c.map(function(b){return{category:b,value:+a[b]}})}),l.domain(h.concat("0 - 199").concat("200 - 399").concat("400 - 599").concat("600 - 799").concat("800 - 999").concat("1000+")),m.domain(c).rangeRoundBands([0,l.rangeBand()]),n.domain([0,d3.max(barChartData,function(a){return d3.max(a.categories,function(a){return a.value})})]),r.selectAll(".x.axis").transition().duration(800).call(p),r.selectAll(".y.axis").transition().duration(800).call(q);var d=r.selectAll(".g").data(barChartData).attr("transform",function(a){return"translate("+l(a.bin)+",0)"}).selectAll("rect").data(function(a){return a.categories}).attr("width",m.rangeBand()).attr("x",function(a){return m(a.category)}).attr("y",function(a){return n(a.value)}).attr("height",function(a){return k-n(a.value)}).style("fill",function(a){return o(a.category)});d.enter().append("rect").attr("width",m.rangeBand()).attr("x",function(a){return m(a.category)}).attr("y",function(a){return n(a.value)}).attr("height",function(a){return k-n(a.value)}).style("fill",function(a){return o(a.category)}).on("mouseover",a).on("mouseout",b),d.exit().remove()}function e(a){var b=r.select(".legend-group").selectAll(".legend").data(a.slice(),function(a){return a}).attr("transform",function(a,b){return"translate(-100,"+12*b+")"});enter_legend=b.enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(-100,"+12*b+")"}),enter_legend.append("rect").attr("x",j-18).attr("width",10).attr("height",10).style("fill",o),enter_legend.append("text").attr("x",j-24).attr("y",6).attr("dy",".35em").attr("font-size","10px").style("text-anchor","end").text(function(a){return a}),b.exit().remove()}return input_checked_count=d3.nest().key(function(a){return a.checked===!0?"true":"false"}).rollup(function(a){return a.length}).map(d3.selectAll('input[name="accident_type"]')[0]),input_checked_count["true"]>6?(d3.select(this).property("checked",!1),void alert("Cannot exceed six checked options.")):void(d3.select(this).property("checked")===!0?(f.push(d3.select(this)[0][0].__data__),e(f),d(f)):(f.splice(f.indexOf(d3.select(this)[0][0].__data__),1),e(f),d(f)))}var d,e,f,g={},h=[],i={top:5,right:5,bottom:30,left:40},j=475-i.left-i.right,k=500-i.top-i.bottom,l=d3.scale.ordinal().rangeRoundBands([0,j],.1),m=d3.scale.ordinal(),n=d3.scale.linear().range([k,0]),o=d3.scale.ordinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"]),p=d3.svg.axis().scale(l).orient("bottom"),q=d3.svg.axis().scale(n).orient("left").tickFormat(d3.format(".2s")),r=d3.select("#bar-charts").append("svg").attr("width",j+i.left+i.right).attr("height",k+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")");d3.csv("../data/part_91_csv/data_1980_84.csv",function(i,s){function t(a,b,c,d,e,f){var h=[];for(var i in a)i in b&&i in c&&i in d&&i in e&&i in f&&"null"!==i&&"bin"!==i&&(h.push(i),g[i]=0);return h}d=d3.nest().key(function(a){return 0<=a.total_hours_flown&&a.total_hours_flown<200?"0 - 199":200<=a.total_hours_flown&&a.total_hours_flown<400?"200 - 399":400<=a.total_hours_flown&&a.total_hours_flown<600?"400 - 599":600<=a.total_hours_flown&&a.total_hours_flown<800?"600 - 799":800<=a.total_hours_flown&&a.total_hours_flown<1e3?"800 - 999":"1000+"}).key(function(a){return a.primary_cause}).sortKeys(d3.ascending).rollup(function(a){return a.length}).entries(s),e=d.map(function(a){var b={};b.bin=a.key;for(var c=0;c<a.values.length;c++)b[a.values[c].key]=a.values[c].values;return b}),commonKeyValues=t(e[0],e[1],e[2],e[3],e[4],e[5]),barChartData=e.map(function(a){var b={};b.bin=a.bin;for(var c=0;c<commonKeyValues.length;c++)b[commonKeyValues[c]]=a[commonKeyValues[c]],g[commonKeyValues[c]]+=a[commonKeyValues[c]];return b}),console.log(d),console.log(e),console.log(commonKeyValues),console.log(barChartData),console.log(g),f=commonKeyValues.filter(function(a,b){return 0===b||1===b||2===b||3===b||4===b||5===b}),barChartData.forEach(function(a){a.categories=f.map(function(b){return{category:b,value:+a[b]}})}),l.domain(h.concat("0 - 199").concat("200 - 399").concat("400 - 599").concat("600 - 799").concat("800 - 999").concat("1000+")),m.domain(f).rangeRoundBands([0,l.rangeBand()]),n.domain([0,d3.max(barChartData,function(a){return d3.max(a.categories,function(a){return a.value})})]),r.append("g").attr("class","x axis").attr("transform","translate(0,"+k+")").call(p).append("text").attr("y",24).attr("dy",".71em").attr("x",j/2).style("text-anchor","end").style("z-index",999).text("Total Hours Flown"),r.append("g").attr("class","y axis").call(q).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").style("z-index",999).text("Frequency");var u=r.selectAll(".bins").data(barChartData).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+l(a.bin)+",0)"}),v=(u.selectAll("rect").data(function(a){return a.categories}).enter().append("rect").attr("width",m.rangeBand()).attr("x",function(a){return m(a.category)}).attr("y",function(a){return n(a.value)}).attr("height",function(a){return k-n(a.value)}).style("fill",function(a){return o(a.category)}).on("mouseover",a).on("mouseout",b),r.append("g").attr("class","legend-group").selectAll(".legend").data(f.slice()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(-100,"+12*b+")"}));v.append("rect").attr("x",j-18).attr("width",10).attr("height",10).style("fill",o),v.append("text").attr("x",j-24).attr("y",6).attr("dy",".35em").attr("font-size","10px").style("text-anchor","end").text(function(a){return a}),inputs=d3.select("#dropdown3").selectAll("input").data(commonKeyValues).enter().append("li").append("a").text(function(a){return a+" ("+g[a]+")"}).append("input").attr("type","checkbox").attr("name","accident_type").attr("value",function(a){return a}).style("left","515px").property("checked",function(a,b){return 0===b||1===b||2===b||3===b||4===b||5===b?!0:!1}).on("click",c)})}();