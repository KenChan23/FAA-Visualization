!function(){function a(a){s="<p>"+a.category+"</p>",hoveredBar=d3.select(this),d3.selectAll(".g rect").filter(function(b){return b!==a}).style("opacity",.3),d3.select("#hello").html(s)}function b(){d3.selectAll(".g rect").style("opacity",1)}function c(c){function d(c){barChartData.forEach(function(a){a.categories=c.map(function(b){return{category:b,value:+a[b]}})}),k.domain(g.concat("0 - 199").concat("200 - 399").concat("400 - 599").concat("600 - 799").concat("800 - 999").concat("1000+")),l.domain(c).rangeRoundBands([0,k.rangeBand()]),m.domain([0,d3.max(barChartData,function(a){return d3.max(a.categories,function(a){return a.value})})]),q.selectAll(".x.axis").transition().duration(800).call(o),q.selectAll(".y.axis").transition().duration(800).call(p);var d=q.selectAll(".g").data(barChartData).attr("transform",function(a){return"translate("+k(a.bin)+",0)"}).selectAll("rect").data(function(a){return a.categories}).attr("width",l.rangeBand()).attr("x",function(a){return l(a.category)}).attr("y",function(a){return m(a.value)}).attr("height",function(a){return j-m(a.value)}).style("fill",function(a){return n(a.category)});d.enter().append("rect").attr("width",l.rangeBand()).attr("x",function(a){return l(a.category)}).attr("y",function(a){return m(a.value)}).attr("height",function(a){return j-m(a.value)}).style("fill",function(a){return n(a.category)}).on("mouseover",a).on("mouseout",b),d.exit().remove()}function e(a){var b=q.select(".legend-group").selectAll(".legend").data(a.slice(),function(a){return a}).attr("transform",function(a,b){return"translate(-100,"+12*b+")"});enter_legend=b.enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(-100,"+12*b+")"}),enter_legend.append("rect").attr("x",i-18).attr("width",10).attr("height",10).style("fill",n),enter_legend.append("text").attr("x",i-24).attr("y",6).attr("dy",".35em").attr("font-size","10px").style("text-anchor","end").text(function(a){return a}),b.exit().remove()}return input_checked_count=d3.nest().key(function(a){return a.checked===!0?"true":"false"}).rollup(function(a){return a.length}).map(d3.selectAll('input[name="accident_type"]')[0]),input_checked_count["true"]>6?(d3.select(this).property("checked",!1),void alert("Cannot exceed six checked options.")):void(d3.select(this).property("checked")===!0?(f.push(d3.select(this)[0][0].__data__),e(f),d(f)):(f.splice(f.indexOf(d3.select(this)[0][0].__data__),1),e(f),d(f)))}var d,e,f,g=[],h={top:5,right:5,bottom:30,left:40},i=475-h.left-h.right,j=500-h.top-h.bottom,k=d3.scale.ordinal().rangeRoundBands([0,i],.1),l=d3.scale.ordinal(),m=d3.scale.linear().range([j,0]),n=d3.scale.ordinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"]),o=d3.svg.axis().scale(k).orient("bottom"),p=d3.svg.axis().scale(m).orient("left").tickFormat(d3.format(".2s")),q=d3.select("#bar-charts").append("svg").attr("width",i+h.left+h.right).attr("height",j+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")");d3.csv("../data/part_91_csv/data_1980_84.csv",function(h,r){function s(a,b,c,d,e,f){var g=[];for(var h in a)h in b&&h in c&&h in d&&h in e&&h in f&&"null"!==h&&"bin"!==h&&g.push(h);return g}d=d3.nest().key(function(a){return 0<=a.total_hours_flown&&a.total_hours_flown<200?"0 - 199":200<=a.total_hours_flown&&a.total_hours_flown<400?"200 - 399":400<=a.total_hours_flown&&a.total_hours_flown<600?"400 - 599":600<=a.total_hours_flown&&a.total_hours_flown<800?"600 - 799":800<=a.total_hours_flown&&a.total_hours_flown<1e3?"800 - 999":"1000+"}).key(function(a){return a.primary_cause}).sortKeys(d3.ascending).rollup(function(a){return a.length}).entries(r),e=d.map(function(a){var b={};b.bin=a.key;for(var c=0;c<a.values.length;c++)b[a.values[c].key]=a.values[c].values;return b}),commonKeyValues=s(e[0],e[1],e[2],e[3],e[4],e[5]),barChartData=e.map(function(a){var b={};b.bin=a.bin;for(var c=0;c<commonKeyValues.length;c++)b[commonKeyValues[c]]=a[commonKeyValues[c]];return b}),f=commonKeyValues.filter(function(a,b){return 0===b||1===b||2===b||3===b||4===b||5===b}),barChartData.forEach(function(a){a.categories=f.map(function(b){return{category:b,value:+a[b]}})}),k.domain(g.concat("0 - 199").concat("200 - 399").concat("400 - 599").concat("600 - 799").concat("800 - 999").concat("1000+")),l.domain(f).rangeRoundBands([0,k.rangeBand()]),m.domain([0,d3.max(barChartData,function(a){return d3.max(a.categories,function(a){return a.value})})]),q.append("g").attr("class","x axis").attr("transform","translate(0,"+j+")").call(o).append("text").attr("y",24).attr("dy",".71em").attr("x",i/2).style("text-anchor","end").style("z-index",999).text("Total Hours Flown"),q.append("g").attr("class","y axis").call(p).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").style("z-index",999).text("Frequency");var t=q.selectAll(".bins").data(barChartData).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+k(a.bin)+",0)"}),u=(t.selectAll("rect").data(function(a){return a.categories}).enter().append("rect").attr("width",l.rangeBand()).attr("x",function(a){return l(a.category)}).attr("y",function(a){return m(a.value)}).attr("height",function(a){return j-m(a.value)}).style("fill",function(a){return n(a.category)}).on("mouseover",a).on("mouseout",b),q.append("g").attr("class","legend-group").selectAll(".legend").data(f.slice()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(-100,"+12*b+")"}));u.append("rect").attr("x",i-18).attr("width",10).attr("height",10).style("fill",n),u.append("text").attr("x",i-24).attr("y",6).attr("dy",".35em").attr("font-size","10px").style("text-anchor","end").text(function(a){return a}),inputs=d3.select("body").selectAll("input").data(commonKeyValues).enter().append("label").attr("display","block").text(function(a){return a}).append("input").attr("type","checkbox").attr("name","accident_type").attr("value",function(a){return a}).property("checked",function(a,b){return 0===b||1===b||2===b||3===b||4===b||5===b?!0:!1}).on("click",c)})}();